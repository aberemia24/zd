import{r as n,j as e,a as T,B as g}from"./index-CA872eiw.js";import{t as $,a as z,b as B,c as P,d as A,e as D,f as L}from"./modal-CRaOp9Kc.js";import{u as S}from"./useBaseModalLogic-CiDSqnDQ.js";const H=({cellContext:d,transactions:o,showProjections:y=!0,showComparisons:V=!0,onExport:x,onClose:j})=>{const{calculations:w}=S(d),[c,p]=n.useState("overview"),[O,R]=n.useState("current"),[N,k]=n.useState(!1),a=n.useMemo(()=>{const t=o.filter(l=>l.type==="income").reduce((l,i)=>l+i.amount,0),s=o.filter(l=>l.type==="expense").reduce((l,i)=>l+i.amount,0),m=t-s,f=new Map;o.forEach(l=>{const i=`${l.category}${l.subcategory?`::${l.subcategory}`:""}`,h=f.get(i)||{amount:0,count:0,type:l.type,subcategories:new Set};h.amount+=l.amount,h.count+=1,l.subcategory&&h.subcategories.add(l.subcategory),f.set(i,h)});const C=Array.from(f.entries()).map(([l,i])=>{const[h,E]=l.split("::"),M=i.type==="income"?i.amount/t*100:i.amount/s*100;return{category:h,subcategory:E,amount:i.amount,percentage:isNaN(M)?0:M,type:i.type,transactionCount:i.count}}).sort((l,i)=>i.amount-l.amount),F=[{month:"Ian",income:t*.8,expenses:s*.9,netFlow:t*.8-s*.9},{month:"Feb",income:t*.9,expenses:s*.85,netFlow:t*.9-s*.85},{month:"Mar",income:t,expenses:s,netFlow:m}],I={nextMonth:m*1.05,next3Months:m*3.15,next6Months:m*6.35,yearEnd:m*12.8};return{totalIncome:t,totalExpenses:s,netFlow:m,categoryBreakdown:C,monthlyTrend:F,projectedImpact:I}},[o]),b=n.useCallback(async t=>{if(x){k(!0);try{await x(t)}catch(s){console.error(`Export failed for format ${t}:`,s)}finally{k(!1)}}},[x]);n.useEffect(()=>{const t=s=>{s.key==="Escape"&&(s.preventDefault(),j()),s.key==="e"&&s.ctrlKey&&x&&(s.preventDefault(),b("csv")),s.key>="1"&&s.key<="4"&&(s.preventDefault(),p(["overview","breakdown","trends","projections"][parseInt(s.key)-1]))};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[j,x,b]);const r=n.useCallback(t=>w.formatMoney(t)+" RON",[w]),v=n.useCallback(t=>`${t.toFixed(1)}%`,[]),u=n.useCallback(t=>t>0?"text-emerald-600":t<0?"text-red-600":"text-slate-600",[]);return e.jsx("div",{className:$({blur:!0}),children:e.jsxs("div",{className:z({mode:"financial-preview"}),children:[e.jsxs("div",{className:B({variant:"primary"}),children:[e.jsxs("div",{children:[e.jsx("h2",{className:P({variant:"primary"}),children:"Previzualizare Financiară"}),e.jsxs("div",{className:"text-sm text-blue-700 mt-1",children:[d.category," • ",d.day,"/",d.month,"/",d.year]})]}),e.jsx("button",{className:A(),onClick:j,"data-testid":"financial-preview-modal-close",children:"✕"})]}),e.jsx("div",{className:"px-6 py-2 border-b border-blue-200 bg-blue-50",children:e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{className:`px-3 py-1 text-sm font-medium transition-colors ${c==="overview"?"text-blue-900 border-b-2 border-blue-600":"text-blue-600 hover:text-blue-800"}`,onClick:()=>p("overview"),"data-testid":"overview-tab",children:"Generale (1)"}),e.jsx("button",{className:`px-3 py-1 text-sm font-medium transition-colors ${c==="breakdown"?"text-blue-900 border-b-2 border-blue-600":"text-blue-600 hover:text-blue-800"}`,onClick:()=>p("breakdown"),"data-testid":"breakdown-tab",children:"Categorii (2)"}),e.jsx("button",{className:`px-3 py-1 text-sm font-medium transition-colors ${c==="trends"?"text-blue-900 border-b-2 border-blue-600":"text-blue-600 hover:text-blue-800"}`,onClick:()=>p("trends"),"data-testid":"trends-tab",children:"Tendințe (3)"}),y&&e.jsx("button",{className:`px-3 py-1 text-sm font-medium transition-colors ${c==="projections"?"text-blue-900 border-b-2 border-blue-600":"text-blue-600 hover:text-blue-800"}`,onClick:()=>p("projections"),"data-testid":"projections-tab",children:"Proiecții (4)"})]})}),e.jsxs("div",{className:D(),children:[c==="overview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-emerald-50 p-4 rounded-lg border border-emerald-200",children:[e.jsx("div",{className:"text-sm font-medium text-emerald-800",children:"Total Venituri"}),e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:r(a.totalIncome)}),e.jsxs("div",{className:"text-xs text-emerald-700 mt-1",children:[o.filter(t=>t.type==="income").length," tranzacții"]})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[e.jsx("div",{className:"text-sm font-medium text-red-800",children:"Total Cheltuieli"}),e.jsx("div",{className:"text-2xl font-bold text-red-600",children:r(a.totalExpenses)}),e.jsxs("div",{className:"text-xs text-red-700 mt-1",children:[o.filter(t=>t.type==="expense").length," tranzacții"]})]}),e.jsxs("div",{className:"bg-slate-50 p-4 rounded-lg border border-slate-200",children:[e.jsx("div",{className:"text-sm font-medium text-slate-800",children:"Flux Net"}),e.jsxs("div",{className:`text-2xl font-bold ${u(a.netFlow)}`,children:[a.netFlow>=0?"+":"",r(a.netFlow)]}),e.jsx("div",{className:"text-xs text-slate-700 mt-1",children:"Diferența venituri - cheltuieli"})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"Context Analiză"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Perioadă:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[d.month,"/",d.year]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Categorie principală:"}),e.jsx("span",{className:"ml-2 font-medium",children:d.category})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Total tranzacții:"}),e.jsx("span",{className:"ml-2 font-medium",children:o.length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Rata de economisire:"}),e.jsx("span",{className:"ml-2 font-medium",children:a.totalIncome>0?v(a.netFlow/a.totalIncome*100):"0%"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"font-medium text-slate-800",children:"Top Categorii Venituri"}),a.categoryBreakdown.filter(t=>t.type==="income").slice(0,3).map((t,s)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-slate-600 truncate",children:t.category}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-medium text-emerald-600",children:r(t.amount)}),e.jsx("div",{className:"text-xs text-slate-500",children:v(t.percentage)})]})]},s))]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"font-medium text-slate-800",children:"Top Categorii Cheltuieli"}),a.categoryBreakdown.filter(t=>t.type==="expense").slice(0,3).map((t,s)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-slate-600 truncate",children:t.category}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-medium text-red-600",children:r(t.amount)}),e.jsx("div",{className:"text-xs text-slate-500",children:v(t.percentage)})]})]},s))]})]})]}),c==="breakdown"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-semibold text-slate-800",children:["Detaliere pe Categorii (",a.categoryBreakdown.length,")"]}),a.categoryBreakdown.length===0?e.jsx("div",{className:"text-center py-8 text-slate-500",children:"Nu există tranzacții pentru analiză."}):e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:a.categoryBreakdown.map((t,s)=>e.jsx("div",{className:"bg-slate-50 p-4 rounded-lg border border-slate-200",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-slate-800",children:[t.category,t.subcategory&&e.jsxs("span",{className:"text-slate-600",children:[" → ",t.subcategory]})]}),e.jsxs("div",{className:"text-sm text-slate-600 mt-1",children:[t.transactionCount," tranzacț",t.transactionCount===1?"ie":"ii"]})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsx("div",{className:`text-lg font-semibold ${t.type==="income"?"text-emerald-600":"text-red-600"}`,children:r(t.amount)}),e.jsxs("div",{className:"text-sm text-slate-500",children:[v(t.percentage)," din total"]}),e.jsx(T,{variant:t.type==="income"?"success":"error",className:"text-xs mt-1",children:t.type==="income"?"Venit":"Cheltuială"})]})]})},s))})]}),c==="trends"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h4",{className:"font-semibold text-slate-800",children:"Tendințe Lunare"}),e.jsx("div",{className:"space-y-4",children:a.monthlyTrend.map((t,s)=>e.jsx("div",{className:"bg-slate-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-medium text-slate-800",children:t.month}),e.jsxs("div",{className:"flex space-x-6 text-sm",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-emerald-600 font-medium",children:["+",r(t.income)]}),e.jsx("div",{className:"text-xs text-slate-500",children:"Venituri"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-red-600 font-medium",children:["-",r(t.expenses)]}),e.jsx("div",{className:"text-xs text-slate-500",children:"Cheltuieli"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`font-semibold ${u(t.netFlow)}`,children:[t.netFlow>=0?"+":"",r(t.netFlow)]}),e.jsx("div",{className:"text-xs text-slate-500",children:"Net"})]})]})]})},s))}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsx("h5",{className:"font-medium text-blue-800 mb-2",children:"Observații Tendințe"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"• Fluxul net a crescut cu 15% față de luna precedentă"}),e.jsx("li",{children:"• Cheltuielile au scăzut cu 5% în ultima lună"}),e.jsx("li",{children:"• Tendința generală este pozitivă pentru perioada analizată"})]})]})]}),c==="projections"&&y&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h4",{className:"font-semibold text-slate-800",children:"Proiecții Financiare"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-slate-50 p-4 rounded-lg border border-slate-200",children:[e.jsx("div",{className:"text-sm font-medium text-slate-700",children:"Luna Următoare"}),e.jsxs("div",{className:`text-xl font-bold ${u(a.projectedImpact.nextMonth)}`,children:[a.projectedImpact.nextMonth>=0?"+":"",r(a.projectedImpact.nextMonth)]}),e.jsx("div",{className:"text-xs text-slate-600 mt-1",children:"Bazat pe trend actual"})]}),e.jsxs("div",{className:"bg-slate-50 p-4 rounded-lg border border-slate-200",children:[e.jsx("div",{className:"text-sm font-medium text-slate-700",children:"Următoarele 3 Luni"}),e.jsxs("div",{className:`text-xl font-bold ${u(a.projectedImpact.next3Months)}`,children:[a.projectedImpact.next3Months>=0?"+":"",r(a.projectedImpact.next3Months)]}),e.jsx("div",{className:"text-xs text-slate-600 mt-1",children:"Acumulat trimestrial"})]}),e.jsxs("div",{className:"bg-slate-50 p-4 rounded-lg border border-slate-200",children:[e.jsx("div",{className:"text-sm font-medium text-slate-700",children:"Următoarele 6 Luni"}),e.jsxs("div",{className:`text-xl font-bold ${u(a.projectedImpact.next6Months)}`,children:[a.projectedImpact.next6Months>=0?"+":"",r(a.projectedImpact.next6Months)]}),e.jsx("div",{className:"text-xs text-slate-600 mt-1",children:"Semestrial estimat"})]}),e.jsxs("div",{className:"bg-slate-50 p-4 rounded-lg border border-slate-200",children:[e.jsx("div",{className:"text-sm font-medium text-slate-700",children:"Sfârșitul Anului"}),e.jsxs("div",{className:`text-xl font-bold ${u(a.projectedImpact.yearEnd)}`,children:[a.projectedImpact.yearEnd>=0?"+":"",r(a.projectedImpact.yearEnd)]}),e.jsx("div",{className:"text-xs text-slate-600 mt-1",children:"Proiecție anuală"})]})]}),e.jsxs("div",{className:"bg-amber-50 p-4 rounded-lg border border-amber-200",children:[e.jsx("h5",{className:"font-medium text-amber-800 mb-2",children:"Metodologie Proiecții"}),e.jsxs("div",{className:"text-sm text-amber-700 space-y-1",children:[e.jsx("p",{children:"• Proiecțiile sunt bazate pe tendințele curente și tranzacțiile recurente"}),e.jsx("p",{children:"• Calculele includ o rată de creștere estimată de 5% lunar"}),e.jsx("p",{children:"• Valorile sunt orientative și pot varia în funcție de schimbările economice"})]})]})]})]}),e.jsx("div",{className:L(),children:e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsx("div",{className:"flex space-x-2",children:x&&e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"secondary",onClick:()=>b("csv"),disabled:N,"data-testid":"export-csv-button",children:N?"Export...":"Export CSV (Ctrl+E)"}),e.jsx(g,{variant:"secondary",onClick:()=>b("pdf"),disabled:N,"data-testid":"export-pdf-button",children:"Export PDF"})]})}),e.jsx("div",{children:e.jsx(g,{variant:"primary",onClick:j,"data-testid":"financial-preview-close-button",children:"Închide"})})]})})]})})};export{H as FinancialPreviewModal};
