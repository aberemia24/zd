import{r as o,j as a,I as f,T as y,C as j,S as k,B as p}from"./index-CA872eiw.js";import{t as N,a as q,b as E,c as L,d as D,e as M,f as S}from"./modal-CRaOp9Kc.js";import{u as w}from"./useBaseModalLogic-CiDSqnDQ.js";const R=({cellContext:s,prefillAmount:l="",autoFocus:v=!0,onSave:m,onCancel:i})=>{const{form:e,validation:n,loading:d,calculations:h}=w(s),[x,g]=o.useState(!1);o.useEffect(()=>{l&&!e.data.amount&&e.updateData({amount:l})},[l]);const u=o.useCallback(async()=>{if(e.validate()){d.setIsLoading(!0);try{await m({amount:e.data.amount,description:e.data.description,recurring:e.data.recurring,frequency:e.data.frequency})}catch{n.setErrors({general:"Eroare la salvarea tranzacției. Încercați din nou."})}finally{d.setIsLoading(!1)}}},[e,d,n,m]);o.useEffect(()=>{const t=r=>{r.key==="Enter"&&r.ctrlKey&&(r.preventDefault(),u()),r.key==="Escape"&&(r.preventDefault(),i())};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[u,i]);const c=e.data.amount?h.calculateFinancialImpact(Number(e.data.amount)):null,b=[{value:"DAILY",label:"Zilnic"},{value:"WEEKLY",label:"Săptămânal"},{value:"MONTHLY",label:"Lunar"},{value:"YEARLY",label:"Anual"}];return a.jsx("div",{className:N({blur:!0}),children:a.jsxs("div",{className:q({mode:"quick-add"}),children:[a.jsxs("div",{className:E({variant:"primary"}),children:[a.jsx("h2",{className:L({variant:"primary"}),children:"Adaugă Tranzacție Rapidă"}),a.jsx("button",{className:D(),onClick:i,"data-testid":"quick-add-modal-close",children:"✕"})]}),a.jsxs("div",{className:M(),children:[a.jsxs("div",{className:"text-sm text-slate-600 bg-blue-50 p-3 rounded-md",children:[a.jsx("strong",{children:s.category}),s.subcategory&&` → ${s.subcategory}`,a.jsx("br",{}),a.jsxs("span",{children:[s.day,"/",s.month,"/",s.year]})]}),a.jsx("div",{children:a.jsx(f,{label:"Sumă (RON)",type:"text",value:e.data.amount,onChange:t=>e.updateData({amount:t.target.value}),error:n.errors.amount,autoFocus:v,"data-testid":"quick-add-amount-input",placeholder:"0.00",pattern:"[0-9]+([,.][0-9]{1,2})?"})}),a.jsx("div",{children:a.jsx(y,{label:"Descriere (opțional)",value:e.data.description,onChange:t=>e.updateData({description:t.target.value}),error:n.errors.description,"data-testid":"quick-add-description-input",placeholder:"Detalii despre tranzacție...",rows:2})}),"          ",a.jsxs("div",{children:["            ",a.jsx(j,{label:"Tranzacție recurentă",checked:e.data.recurring,onChange:t=>{const r=t.target.checked;e.updateData({recurring:r}),g(r),r||e.updateData({frequency:void 0})},"data-testid":"quick-add-recurring-checkbox"}),"          "]}),"          ","          ",x&&a.jsxs("div",{className:"pl-6 border-l-2 border-blue-200",children:["              ",a.jsx(k,{label:"Frecvență",value:e.data.frequency||"",onChange:t=>e.updateData({frequency:t.target.value}),options:b,error:n.errors.frequency,"data-testid":"quick-add-frequency-select",placeholder:"Selectează frecvența"}),"            "]}),c&&a.jsx("div",{className:"bg-slate-50 p-3 rounded-md text-sm",children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{children:"Impact financiar:"}),a.jsxs("span",{className:`font-semibold ${c.isPositive?"text-emerald-600":"text-red-600"}`,children:[c.isPositive?"+":"",c.amount," RON"]})]})}),n.errors.general&&a.jsx("div",{className:"text-red-600 text-sm bg-red-50 p-3 rounded-md",children:n.errors.general})]}),a.jsxs("div",{className:S(),children:[a.jsx(p,{variant:"secondary",onClick:i,disabled:d.isLoading,"data-testid":"quick-add-cancel-button",children:"Anulează"}),a.jsx(p,{variant:"primary",onClick:u,disabled:d.isLoading||!e.data.amount,"data-testid":"quick-add-save-button",children:d.isLoading?"Salvează...":"Salvează (Ctrl+Enter)"})]})]})})};export{R as QuickAddModal};
